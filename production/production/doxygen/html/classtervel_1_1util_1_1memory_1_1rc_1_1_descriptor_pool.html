<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Tervel: tervel::util::memory::rc::DescriptorPool Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tervel
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">A collection of wait-free containers and algorithms.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacetervel.html">tervel</a></li><li class="navelem"><a class="el" href="namespacetervel_1_1util.html">util</a></li><li class="navelem"><a class="el" href="namespacetervel_1_1util_1_1memory.html">memory</a></li><li class="navelem"><a class="el" href="namespacetervel_1_1util_1_1memory_1_1rc.html">rc</a></li><li class="navelem"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html">DescriptorPool</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">tervel::util::memory::rc::DescriptorPool Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Defines a pool of descriptor objects which is used to allocate descriptors and to store them while they are not safe to delete.  
 <a href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="descriptor__pool_8h_source.html">descriptor_pool.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a552444bec208a324258ef830fa45597d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a552444bec208a324258ef830fa45597d">DescriptorPool</a> (<a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_pool_manager.html">PoolManager</a> *manager, uint64_t pool_id, int prefill=<a class="el" href="util_8h.html#afd0fad68cb3234a00478ba61d879a895">TERVEL_MEM_RC_MIN_NODES</a>)</td></tr>
<tr class="separator:a552444bec208a324258ef830fa45597d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3e88ac0469b52e803f4f1991611f72e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#ac3e88ac0469b52e803f4f1991611f72e">~DescriptorPool</a> ()</td></tr>
<tr class="separator:ac3e88ac0469b52e803f4f1991611f72e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d086ae584f1ce4b23ec0f3040503c7d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a6d086ae584f1ce4b23ec0f3040503c7d">reserve</a> (size_t num_descriptors=<a class="el" href="util_8h.html#afd0fad68cb3234a00478ba61d879a895">TERVEL_MEM_RC_MIN_NODES</a>)</td></tr>
<tr class="memdesc:a6d086ae584f1ce4b23ec0f3040503c7d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates an extra <code>num_descriptors</code> elements to the pool.  <a href="#a6d086ae584f1ce4b23ec0f3040503c7d">More...</a><br /></td></tr>
<tr class="separator:a6d086ae584f1ce4b23ec0f3040503c7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeba4dbb575d67e4c2425e1b15c4b3f11"><td class="memTemplParams" colspan="2">template&lt;typename DescrType , typename... Args &gt; </td></tr>
<tr class="memitem:aeba4dbb575d67e4c2425e1b15c4b3f11"><td class="memTemplItemLeft" align="right" valign="top">DescrType *&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#aeba4dbb575d67e4c2425e1b15c4b3f11">get_descriptor</a> (Args &amp;&amp;...args)</td></tr>
<tr class="memdesc:aeba4dbb575d67e4c2425e1b15c4b3f11"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructs and returns a descriptor.  <a href="#aeba4dbb575d67e4c2425e1b15c4b3f11">More...</a><br /></td></tr>
<tr class="separator:aeba4dbb575d67e4c2425e1b15c4b3f11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa81862471eea9aeed3b04ecc503b9197"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#aa81862471eea9aeed3b04ecc503b9197">free_descriptor</a> (<a class="el" href="classtervel_1_1util_1_1_descriptor.html">tervel::util::Descriptor</a> *descr, bool dont_check=false)</td></tr>
<tr class="memdesc:aa81862471eea9aeed3b04ecc503b9197"><td class="mdescLeft">&#160;</td><td class="mdescRight">Once a user is done with a descriptor, they should free it with this method.  <a href="#aa81862471eea9aeed3b04ecc503b9197">More...</a><br /></td></tr>
<tr class="separator:aa81862471eea9aeed3b04ecc503b9197"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a6a96d2e2269fdf2b9f56bf4249f1ef24"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a6a96d2e2269fdf2b9f56bf4249f1ef24">get_from_pool</a> (bool allocate_new=true)</td></tr>
<tr class="memdesc:a6a96d2e2269fdf2b9f56bf4249f1ef24"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets a free element.  <a href="#a6a96d2e2269fdf2b9f56bf4249f1ef24">More...</a><br /></td></tr>
<tr class="separator:a6a96d2e2269fdf2b9f56bf4249f1ef24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a768ce63acad7353b919e71c722f5fe30"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a768ce63acad7353b919e71c722f5fe30">send_safe_to_manager</a> ()</td></tr>
<tr class="memdesc:a768ce63acad7353b919e71c722f5fe30"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends the elements from the safe pool to the corresponding safe pool in this pool's manager.  <a href="#a768ce63acad7353b919e71c722f5fe30">More...</a><br /></td></tr>
<tr class="separator:a768ce63acad7353b919e71c722f5fe30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e869b61b3689ce58c8749016d380926"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a3e869b61b3689ce58c8749016d380926">send_unsafe_to_manager</a> ()</td></tr>
<tr class="memdesc:a3e869b61b3689ce58c8749016d380926"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends the elements from the unsafe pool to the corresponding unsafe pool in this pool's manager.  <a href="#a3e869b61b3689ce58c8749016d380926">More...</a><br /></td></tr>
<tr class="separator:a3e869b61b3689ce58c8749016d380926"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a362beb1ef559ba40a64ca78ffca12cff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a362beb1ef559ba40a64ca78ffca12cff">offload</a> ()</td></tr>
<tr class="memdesc:a362beb1ef559ba40a64ca78ffca12cff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a subset of the elements to the managers pool.  <a href="#a362beb1ef559ba40a64ca78ffca12cff">More...</a><br /></td></tr>
<tr class="separator:a362beb1ef559ba40a64ca78ffca12cff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a573585b4dd774585e2430970f8c1b3fb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a573585b4dd774585e2430970f8c1b3fb">add_to_safe</a> (<a class="el" href="classtervel_1_1util_1_1_descriptor.html">tervel::util::Descriptor</a> *descr)</td></tr>
<tr class="memdesc:a573585b4dd774585e2430970f8c1b3fb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Releases the descriptor back to the safe pool.  <a href="#a573585b4dd774585e2430970f8c1b3fb">More...</a><br /></td></tr>
<tr class="separator:a573585b4dd774585e2430970f8c1b3fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae0b2295f7166b40c9c748a5ed78f570"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#aae0b2295f7166b40c9c748a5ed78f570">add_to_unsafe</a> (<a class="el" href="classtervel_1_1util_1_1_descriptor.html">tervel::util::Descriptor</a> *descr)</td></tr>
<tr class="memdesc:aae0b2295f7166b40c9c748a5ed78f570"><td class="mdescLeft">&#160;</td><td class="mdescRight">Releases the descriptor back to the unsafe pool.  <a href="#aae0b2295f7166b40c9c748a5ed78f570">More...</a><br /></td></tr>
<tr class="separator:aae0b2295f7166b40c9c748a5ed78f570"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff5201eac41e952363dab1e23949f629"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#aff5201eac41e952363dab1e23949f629">try_clear_unsafe_pool</a> (bool dont_check=false)</td></tr>
<tr class="memdesc:aff5201eac41e952363dab1e23949f629"><td class="mdescLeft">&#160;</td><td class="mdescRight">Try to move elements from the unsafe pool to the safe pool.  <a href="#aff5201eac41e952363dab1e23949f629">More...</a><br /></td></tr>
<tr class="separator:aff5201eac41e952363dab1e23949f629"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a602d77f377890c6c32311d8764a616a5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a602d77f377890c6c32311d8764a616a5">verify_pool_count</a> (<a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a> *pool, uint64_t count)</td></tr>
<tr class="memdesc:a602d77f377890c6c32311d8764a616a5"><td class="mdescLeft">&#160;</td><td class="mdescRight">verifies that the length of the linked list matches the count  <a href="#a602d77f377890c6c32311d8764a616a5">More...</a><br /></td></tr>
<tr class="separator:a602d77f377890c6c32311d8764a616a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a47980d510a2178f37a1c44fb54be54"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a1a47980d510a2178f37a1c44fb54be54">DISALLOW_COPY_AND_ASSIGN</a> (<a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html">DescriptorPool</a>)</td></tr>
<tr class="separator:a1a47980d510a2178f37a1c44fb54be54"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a571b9eb199df3356d66d3a8137ad9944"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_pool_manager.html">PoolManager</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a571b9eb199df3356d66d3a8137ad9944">manager_</a></td></tr>
<tr class="memdesc:a571b9eb199df3356d66d3a8137ad9944"><td class="mdescLeft">&#160;</td><td class="mdescRight">This pool's manager.  <a href="#a571b9eb199df3356d66d3a8137ad9944">More...</a><br /></td></tr>
<tr class="separator:a571b9eb199df3356d66d3a8137ad9944"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adec7cbd5e692812b0aa0afefa04697d7"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#adec7cbd5e692812b0aa0afefa04697d7">pool_id_</a></td></tr>
<tr class="memdesc:adec7cbd5e692812b0aa0afefa04697d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">The pool where excess elements are placed.  <a href="#adec7cbd5e692812b0aa0afefa04697d7">More...</a><br /></td></tr>
<tr class="separator:adec7cbd5e692812b0aa0afefa04697d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a816f71722b9a18b007154e27bdb153bd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a816f71722b9a18b007154e27bdb153bd">safe_pool_</a> {nullptr}</td></tr>
<tr class="memdesc:a816f71722b9a18b007154e27bdb153bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">A linked list of pool elements.  <a href="#a816f71722b9a18b007154e27bdb153bd">More...</a><br /></td></tr>
<tr class="separator:a816f71722b9a18b007154e27bdb153bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a850e99b50092270ccc5e8529cffe294b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a850e99b50092270ccc5e8529cffe294b">unsafe_pool_</a> {nullptr}</td></tr>
<tr class="memdesc:a850e99b50092270ccc5e8529cffe294b"><td class="mdescLeft">&#160;</td><td class="mdescRight">A linked list of pool elements.  <a href="#a850e99b50092270ccc5e8529cffe294b">More...</a><br /></td></tr>
<tr class="separator:a850e99b50092270ccc5e8529cffe294b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a121f3c807724ee68f21faf5e659c2cf7"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a121f3c807724ee68f21faf5e659c2cf7">safe_pool_count_</a> {0}</td></tr>
<tr class="memdesc:a121f3c807724ee68f21faf5e659c2cf7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Two counters used to track the number of elements in the linked list.  <a href="#a121f3c807724ee68f21faf5e659c2cf7">More...</a><br /></td></tr>
<tr class="separator:a121f3c807724ee68f21faf5e659c2cf7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b8a73ac56132217ea75bd6f5d13ba98"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a8b8a73ac56132217ea75bd6f5d13ba98">unsafe_pool_count_</a> {0}</td></tr>
<tr class="separator:a8b8a73ac56132217ea75bd6f5d13ba98"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Defines a pool of descriptor objects which is used to allocate descriptors and to store them while they are not safe to delete. </p>
<p>The pool is represented as two linked lists of descriptors: one for safe elements and one for unsafe elements. The safe pool is known to only contain items owned by the thread owning the <a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html" title="Defines a pool of descriptor objects which is used to allocate descriptors and to store them while th...">DescriptorPool</a> object, and the unsafe pool contains items where other threads may still hold references to them.</p>
<p>Further, the pool object has a parent who is shared amongst other threads. When a pool is to be destroyed, it sends its remaining elements to the parent, relinquishing ownership of said elements. A top-level pool has a null parent. At the moment, it only makes sense to have a single top-level parent representing the central pool for all threads, and several local pools for each thread. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a552444bec208a324258ef830fa45597d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">tervel::util::memory::rc::DescriptorPool::DescriptorPool </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_pool_manager.html">PoolManager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>pool_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>prefill</em> = <code><a class="el" href="util_8h.html#afd0fad68cb3234a00478ba61d879a895">TERVEL_MEM_RC_MIN_NODES</a></code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ac3e88ac0469b52e803f4f1991611f72e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">tervel::util::memory::rc::DescriptorPool::~DescriptorPool </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a573585b4dd774585e2430970f8c1b3fb"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::util::memory::rc::DescriptorPool::add_to_safe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classtervel_1_1util_1_1_descriptor.html">tervel::util::Descriptor</a> *&#160;</td>
          <td class="paramname"><em>descr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Releases the descriptor back to the safe pool. </p>
<p>Caller relinquishes ownership of descriptor. It's expected that the given descriptor was taken from this pool to begin with.</p>
<p>Adding a descriptor to the safe pool calls its 'on_return_to_pool' method and its destructor. </p>

</div>
</div>
<a class="anchor" id="aae0b2295f7166b40c9c748a5ed78f570"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::util::memory::rc::DescriptorPool::add_to_unsafe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classtervel_1_1util_1_1_descriptor.html">tervel::util::Descriptor</a> *&#160;</td>
          <td class="paramname"><em>descr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Releases the descriptor back to the unsafe pool. </p>
<p>Caller relinquishes ownership of descriptor. It's expected that the given descriptor was taken from this pool to begin with.</p>
<p>See notes on <a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html#a573585b4dd774585e2430970f8c1b3fb" title="Releases the descriptor back to the safe pool. ">add_to_safe()</a> </p>

</div>
</div>
<a class="anchor" id="a1a47980d510a2178f37a1c44fb54be54"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">tervel::util::memory::rc::DescriptorPool::DISALLOW_COPY_AND_ASSIGN </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_descriptor_pool.html">DescriptorPool</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aa81862471eea9aeed3b04ecc503b9197"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::util::memory::rc::DescriptorPool::free_descriptor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classtervel_1_1util_1_1_descriptor.html">tervel::util::Descriptor</a> *&#160;</td>
          <td class="paramname"><em>descr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>dont_check</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Once a user is done with a descriptor, they should free it with this method. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">descr</td><td>The descriptor to free. </td></tr>
    <tr><td class="paramname">dont_check</td><td>Don't check if the descriptor is being watched before freeing it. Use this flag if you know that no other thread has had access to this descriptor. </td></tr>
    <tr><td class="paramname">pool</td><td>the pool to use when freeing the descriptor. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aeba4dbb575d67e4c2425e1b15c4b3f11"></a>
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename DescrType , typename... Args &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">DescrType * tervel::util::memory::rc::DescriptorPool::get_descriptor </td>
          <td>(</td>
          <td class="paramtype">Args &amp;&amp;...&#160;</td>
          <td class="paramname"><em>args</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructs and returns a descriptor. </p>
<p>Arguments are forwarded to the constructor of the given descriptor type. User should call free_descriptor on the returned pointer when they are done with it to avoid memory leaks. </p>

</div>
</div>
<a class="anchor" id="a6a96d2e2269fdf2b9f56bf4249f1ef24"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a>* tervel::util::memory::rc::DescriptorPool::get_from_pool </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>allocate_new</em> = <code>true</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets a free element. </p>
<p>The local pool is checked for one first, then the manager if there are no local ones, and if all else fails, a new one is allocated using new.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">allocate_new</td><td>If true and there are no free elements to retrieve from the pool, a new one is allocated. Otherwise, nullptr is returned. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a362beb1ef559ba40a64ca78ffca12cff"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::util::memory::rc::DescriptorPool::offload </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sends a subset of the elements to the managers pool. </p>

</div>
</div>
<a class="anchor" id="a6d086ae584f1ce4b23ec0f3040503c7d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::util::memory::rc::DescriptorPool::reserve </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>num_descriptors</em> = <code><a class="el" href="util_8h.html#afd0fad68cb3234a00478ba61d879a895">TERVEL_MEM_RC_MIN_NODES</a></code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates an extra <code>num_descriptors</code> elements to the pool. </p>

</div>
</div>
<a class="anchor" id="a768ce63acad7353b919e71c722f5fe30"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::util::memory::rc::DescriptorPool::send_safe_to_manager </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sends the elements from the safe pool to the corresponding safe pool in this pool's manager. </p>

</div>
</div>
<a class="anchor" id="a3e869b61b3689ce58c8749016d380926"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::util::memory::rc::DescriptorPool::send_unsafe_to_manager </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sends the elements from the unsafe pool to the corresponding unsafe pool in this pool's manager. </p>

</div>
</div>
<a class="anchor" id="aff5201eac41e952363dab1e23949f629"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void tervel::util::memory::rc::DescriptorPool::try_clear_unsafe_pool </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>dont_check</em> = <code>false</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Try to move elements from the unsafe pool to the safe pool. </p>

</div>
</div>
<a class="anchor" id="a602d77f377890c6c32311d8764a616a5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool tervel::util::memory::rc::DescriptorPool::verify_pool_count </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>verifies that the length of the linked list matches the count </p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a571b9eb199df3356d66d3a8137ad9944"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_pool_manager.html">PoolManager</a>* tervel::util::memory::rc::DescriptorPool::manager_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This pool's manager. </p>

</div>
</div>
<a class="anchor" id="adec7cbd5e692812b0aa0afefa04697d7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t tervel::util::memory::rc::DescriptorPool::pool_id_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The pool where excess elements are placed. </p>

</div>
</div>
<a class="anchor" id="a816f71722b9a18b007154e27bdb153bd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a>* tervel::util::memory::rc::DescriptorPool::safe_pool_ {nullptr}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A linked list of pool elements. </p>
<p>One can be assured that no thread will try to access the descriptor of any element in this pool. They can't be freed as some threads may still have access to the element itself and may try to increment the refrence count. </p>

</div>
</div>
<a class="anchor" id="a121f3c807724ee68f21faf5e659c2cf7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t tervel::util::memory::rc::DescriptorPool::safe_pool_count_ {0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Two counters used to track the number of elements in the linked list. </p>
<p>this facilitates the detection of when there are too many elements. </p>

</div>
</div>
<a class="anchor" id="a850e99b50092270ccc5e8529cffe294b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classtervel_1_1util_1_1memory_1_1rc_1_1_pool_element.html">PoolElement</a>* tervel::util::memory::rc::DescriptorPool::unsafe_pool_ {nullptr}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A linked list of pool elements. </p>
<p>Elements get released to this pool when they're no longer needed, but some threads may still try to access the descriptor in the element. After some time has passed, items generally move from this pool to the safe_pool_ </p>

</div>
</div>
<a class="anchor" id="a8b8a73ac56132217ea75bd6f5d13ba98"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t tervel::util::memory::rc::DescriptorPool::unsafe_pool_count_ {0}</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>tervel/util/memory/rc/<a class="el" href="descriptor__pool_8h_source.html">descriptor_pool.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 4 2015 20:55:22 for Tervel by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
